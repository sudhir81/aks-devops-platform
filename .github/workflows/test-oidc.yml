name: ğŸ” Test OIDC Azure Login

on:
  workflow_dispatch:

permissions:
  id-token: write
  contents: read

jobs:
  verify:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ” Azure Login via OIDC
        uses: azure/login@v2
        with:
          client-id: ${{ secrets.ARM_CLIENT_ID }}
          tenant-id: ${{ secrets.ARM_TENANT_ID }}
          subscription-id: ${{ secrets.ARM_SUBSCRIPTION_ID }}
          allow-no-subscriptions: true

      - name: ğŸ§© Verify Azure Context
        run: |
          echo "=== Azure Subscription Context ==="
          az account show --output jsonc

      - name: ğŸ‘¤ Verify Azure Identity
        run: |
          echo "ğŸ” Checking current signed-in identity..."
          az ad signed-in-user show --query "{displayName:displayName, id:id, userPrincipalName:userPrincipalName}" -o jsonc || \
          echo "âš ï¸ Service Principal detected (expected for OIDC)"
